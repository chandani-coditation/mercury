{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Incident Schema",
  "description": "JSON schema for validating incident structure",
  "type": "object",
  "required": ["title", "description"],
  "properties": {
    "incident_id": {
      "type": ["string", "null"],
      "description": "ServiceNow incident number"
    },
    "alert_id": {
      "type": ["string", "null"],
      "description": "Related alert ID"
    },
    "title": {
      "type": "string",
      "description": "Incident title/summary",
      "minLength": 1,
      "maxLength": 500
    },
    "description": {
      "type": "string",
      "description": "Full incident description",
      "minLength": 1
    },
    "severity": {
      "type": ["string", "null"],
      "description": "Severity level",
      "enum": ["critical", "high", "medium", "low", null]
    },
    "category": {
      "type": ["string", "null"],
      "description": "Incident category"
    },
    "affected_services": {
      "type": ["array", "null"],
      "description": "List of affected services",
      "items": {
        "type": "string"
      }
    },
    "resolution_steps": {
      "type": ["array", "null"],
      "description": "Resolution steps taken",
      "items": {
        "type": "string"
      }
    },
    "root_cause": {
      "type": ["string", "null"],
      "description": "Root cause analysis"
    },
    "timestamp": {
      "type": ["string", "null"],
      "description": "Incident timestamp (ISO 8601 format)",
      "format": "date-time"
    },
    "raw_content": {
      "type": ["string", "null"],
      "description": "Unstructured raw content"
    },
    "metadata": {
      "type": ["object", "null"],
      "description": "Additional metadata",
      "properties": {
        "source": {
          "type": ["string", "null"],
          "enum": ["servicenow", "manual", null]
        },
        "assignment_group": {
          "type": ["string", "null"]
        },
        "state": {
          "type": ["string", "null"]
        },
        "impact": {
          "type": ["string", "null"]
        },
        "urgency": {
          "type": ["string", "null"]
        }
      }
    },
    "tags": {
      "type": ["object", "null"],
      "description": "Metadata tags",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["historical_incident"]
        },
        "ticket_id": {
          "type": ["string", "null"]
        },
        "canonical_incident_key": {
          "type": ["string", "null"]
        },
        "incident_id": {
          "type": ["string", "null"]
        }
      }
    }
  }
}

